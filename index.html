<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Life Dashboard</title>
    <!-- PWA MANIFEST -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTWVybyBKaXZhbiIsInNob3J0X25hbWUiOiJNZXJvIEppdmFuIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMDY4OTBhIiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vcGxhY2Vob2xkLmNvLzEyOHgzMjgvMDY4OTBhL0ZGRiIsInNpemVzIjoiMTI4eDEyOCJ9XX0=">
    <meta name="theme-color" content="#06890a">
    <!-- NOTIFICATION PERMISSION -->
    <script>if ('Notification' in window && Notification.permission === 'default') Notification.requestPermission();</script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        /* Disable zoom on mobile */
        html, body {
            touch-action: pan-y;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* Allow scrolling */
        .scroll-container {
            -webkit-overflow-scrolling: touch;
        }
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
    </style>
</head>
<body class="scroll-container">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo, useRef } = React;

      // --- FIREBASE CONFIGURATION ---
      const firebaseConfig = {
        apiKey: "AIzaSyCwQVdSe_BvFgxwXd4oP6PPOuh6NrJaXNY",
        authDomain: "mero-jivan-cd3a6.firebaseapp.com",
        databaseURL: "https://mero-jivan-cd3a6-default-rtdb.firebaseio.com",
        projectId: "mero-jivan-cd3a6",
        storageBucket: "mero-jivan-cd3a6.firebasestorage.app",
        messagingSenderId: "244728705595",
        appId: "1:244728705595:web:dddc0a53d7cae21bbba21e",
        measurementId: "G-3RVXWQMYTL"
      };

      // Initialize Firebase
      let auth, database;
      try {
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        auth = firebase.auth();
        database = firebase.database();
        console.log('Firebase initialized successfully');
      } catch (error) {
        console.error('Firebase initialization failed:', error);
      }

      // --- ICONS (as SVG components) ---
      const MoneyIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>);
      const LifeIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>);
      const GrowIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>);
      const AccountIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>);
      const PlusIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>);
      const MinusIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 12H6" /></svg>);
      const FoodIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" /></svg>);
      const TransportIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>);
      const BillsIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>);
      const ShoppingIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>);
      const FunIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>);
      const HealthIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>);
      const OtherIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" /></svg>);
      const SalaryIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>);
      const GiftIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" /></svg>);
      const BackArrowIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>);
      const EditIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>);
      const DeleteIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" /></svg>);
      const GoogleIcon = () => (<svg className="w-4 h-4" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>);
      const MessageIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>);
      const MovieIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" /></svg>);
      const BookIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>);
      const SyncIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>);

      // --- DATA & HELPERS ---
      const CATEGORIES = { expense: [{ id: 'food', name: 'Food', Icon: FoodIcon, color: '#FF6384' },{ id: 'transport', name: 'Transport', Icon: TransportIcon, color: '#36A2EB' },{ id: 'home', name: 'Home', Icon: OtherIcon, color: '#FFCE56' },{ id: 'bills', name: 'Bills', Icon: BillsIcon, color: '#4BC0C0' },{ id: 'shopping', name: 'Shopping', Icon: ShoppingIcon, color: '#9966FF' },{ id: 'fun', name: 'Fun', Icon: FunIcon, color: '#FF9F40' },{ id: 'health', name: 'Health', Icon: HealthIcon, color: '#E83E8C' },{ id: 'other_expense', name: 'Other', Icon: OtherIcon, color: '#6C757D' }], income: [{ id: 'salary', name: 'Salary', Icon: SalaryIcon },{ id: 'gift', name: 'Gift', Icon: GiftIcon },{ id: 'other_income', name: 'Other', Icon: OtherIcon }] };
      const ALL_CATEGORIES = [...CATEGORIES.expense, ...CATEGORIES.income].reduce((acc, cat) => { acc[cat.id] = cat; return acc; }, {});
      const NEPALI_MONTH_DATA = { 2070: [30, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2071: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2072: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2073: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2074: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2075: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2076: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2077: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2078: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2079: [31, 31, 32, 32, 31, 30, 29, 30, 29, 30, 29, 31], 2080: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2081: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2082: [30, 32, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2083: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2084: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2085: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2086: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2087: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2088: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2089: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2090: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30] };
      const NEPALI_MONTHS = ['Baishakh','Jestha','Ashadh','Shrawan','Bhadra','Ashwin','Kartik','Mangsir','Poush','Magh','Falgun','Chaitra'];
      const NEPALI_YEAR_START_GREGORIAN_DATE = { 2070: '2013-04-14', 2071: '2014-04-14', 2072: '2015-04-14', 2073: '2016-04-13', 2074: '2017-04-14', 2075: '2018-04-14', 2076: '2019-04-14', 2077: '2020-04-13', 2078: '2021-04-14', 2079: '2022-04-14', 2080: '2023-04-14', 2081: '2024-04-13', 2082: '2025-04-14', 2083: '2026-04-14', 2084: '2027-04-14', 2085: '2028-04-13', 2086: '2029-04-14', 2087: '2030-04-14', 2088: '2031-04-14', 2089: '2032-04-13', 2090: '2033-04-14' };
      const gregorianToNepali = (gregorianDate) => { const defaultDate = { year: 2081, month: 1, day: 1, monthName: 'Baishakh' }; if (!gregorianDate) return defaultDate; const inputDate = new Date(gregorianDate); inputDate.setUTCHours(0, 0, 0, 0); let nepaliYear; const sortedYears = Object.keys(NEPALI_YEAR_START_GREGORIAN_DATE).sort((a, b) => b - a); for (const year of sortedYears) { const startDate = new Date(NEPALI_YEAR_START_GREGORIAN_DATE[year]); startDate.setUTCHours(0, 0, 0, 0); if (inputDate >= startDate) { nepaliYear = parseInt(year); break; } } if (!nepaliYear) return defaultDate; const nepaliYearStartDate = new Date(NEPALI_YEAR_START_GREGORIAN_DATE[nepaliYear]); nepaliYearStartDate.setUTCHours(0, 0, 0, 0); const dayDiff = Math.round((inputDate - nepaliYearStartDate) / (1000 * 60 * 60 * 24)); let nepaliMonth = 1, nepaliDay = dayDiff + 1; const monthDaysData = NEPALI_MONTH_DATA[nepaliYear]; if (!monthDaysData) return defaultDate; for (let i = 0; i < monthDaysData.length; i++) { const daysInMonth = monthDaysData[i]; if (nepaliDay <= daysInMonth) break; else { nepaliDay -= daysInMonth; nepaliMonth++; } } return { year: nepaliYear, month: nepaliMonth, day: nepaliDay, monthName: NEPALI_MONTHS[nepaliMonth - 1] }; };
      const nepaliToGregorian = (nepaliYear, nepaliMonth, nepaliDay) => { const gregorianStartDateStr = NEPALI_YEAR_START_GREGORIAN_DATE[nepaliYear]; if (!gregorianStartDateStr) return new Date().toISOString().split('T')[0]; const gregorianStartDate = new Date(gregorianStartDateStr); let daysToAdd = 0; const monthData = NEPALI_MONTH_DATA[nepaliYear]; if (!monthData) return new Date().toISOString().split('T')[0]; for (let i = 0; i < nepaliMonth - 1; i++) { daysToAdd += monthData[i]; } daysToAdd += nepaliDay - 1; const resultDate = new Date(gregorianStartDate.getTime()); resultDate.setDate(gregorianStartDate.getDate() + daysToAdd); return resultDate.toISOString().split('T')[0]; };
      
      // ENHANCED WORKOUT DATA WITH REAL EXERCISES AND CORRECT GIFs
      const WORKOUT_DATA = {
          'Chest': [
              { 
                  id: 1, 
                  name: 'Barbell Bench Press', 
                  description: 'Lie on a flat bench with feet firmly on the ground. Grip barbell slightly wider than shoulder width. Lower bar to chest, then press back up explosively. Keep your back flat and maintain proper form throughout the movement.',
                  gif: 'https://i.ibb.co/0j1Wq2L/bench-press.gif',
                  equipment: 'Barbell, Bench',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 2, 
                  name: 'Incline Dumbbell Press', 
                  description: 'Lie on incline bench (30-45 degrees). Press dumbbells upward until arms are extended. Lower with control to chest level. This targets the upper chest muscles effectively.',
                  gif: 'https://i.ibb.co/7YfL1ZR/incline-dumbbell-press.gif',
                  equipment: 'Dumbbells, Incline Bench',
                  difficulty: 'Beginner'
              },
              { 
                  id: 3, 
                  name: 'Push-ups', 
                  description: 'Start in plank position with hands shoulder-width apart. Lower body until chest nearly touches floor, keeping elbows close to body. Push back up to start position while maintaining a straight body line.',
                  gif: 'https://i.ibb.co/0QY1q1L/push-ups.gif',
                  equipment: 'Bodyweight',
                  difficulty: 'Beginner'
              }
          ],
          'Back': [
              { 
                  id: 4, 
                  name: 'Pull-ups', 
                  description: 'Hang from bar with overhand grip, hands wider than shoulders. Pull body up until chin is above bar. Lower with control back to starting position. Engage your back muscles throughout the movement.',
                  gif: 'https://i.ibb.co/0QY1q1L/pull-ups.gif',
                  equipment: 'Pull-up Bar',
                  difficulty: 'Advanced'
              },
              { 
                  id: 5, 
                  name: 'Bent Over Barbell Row', 
                  description: 'Stand with feet shoulder-width apart, bend knees slightly. Hinge at hips until torso is nearly parallel to floor. Pull barbell to lower chest while squeezing shoulder blades together.',
                  gif: 'https://i.ibb.co/0QY1q1L/bent-over-row.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 6, 
                  name: 'Lat Pulldown', 
                  description: 'Sit at lat pulldown machine with knees secured under pads. Grip bar wide, pull down to upper chest while leaning back slightly. Focus on using your back muscles, not your arms.',
                  gif: 'https://i.ibb.co/0QY1q1L/lat-pulldown.gif',
                  equipment: 'Cable Machine',
                  difficulty: 'Beginner'
              }
          ],
          'Shoulders': [
              { 
                  id: 7, 
                  name: 'Overhead Press', 
                  description: 'Stand with barbell at shoulder level, hands slightly wider than shoulders. Press barbell overhead until arms are fully extended. Lower with control. Keep your core tight throughout the movement.',
                  gif: 'https://i.ibb.co/0QY1q1L/overhead-press.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 8, 
                  name: 'Dumbbell Lateral Raise', 
                  description: 'Stand holding dumbbells at sides with palms facing each other. Raise arms out to sides until parallel with floor. Lower with control. Use light weights and focus on proper form.',
                  gif: 'https://i.ibb.co/0QY1q1L/lateral-raise.gif',
                  equipment: 'Dumbbells',
                  difficulty: 'Beginner'
              },
              { 
                  id: 9, 
                  name: 'Front Dumbbell Raise', 
                  description: 'Stand holding dumbbells in front of thighs with palms facing down. Raise one arm forward until parallel with floor. Alternate arms. Keep movements controlled and avoid swinging.',
                  gif: 'https://i.ibb.co/0QY1q1L/front-raise.gif',
                  equipment: 'Dumbbells',
                  difficulty: 'Beginner'
              }
          ],
          'Legs': [
              { 
                  id: 10, 
                  name: 'Barbell Squats', 
                  description: 'Stand with barbell across upper back, feet shoulder-width apart. Lower hips back and down as if sitting in a chair. Go as deep as comfortable, then drive back up through heels.',
                  gif: 'https://i.ibb.co/0QY1q1L/squats.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 11, 
                  name: 'Romanian Deadlifts', 
                  description: 'Hold barbell with overhand grip, feet hip-width apart. Hinge at hips while keeping back straight. Lower barbell along legs until you feel hamstring stretch. Return to start position.',
                  gif: 'https://i.ibb.co/0QY1q1L/romanian-deadlift.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 12, 
                  name: 'Walking Lunges', 
                  description: 'Step forward with one leg, lowering hips until both knees are bent at 90-degree angle. Front knee should be above ankle, back knee hovering just above ground. Push off back foot to return to start or continue walking forward.',
                  gif: 'https://i.ibb.co/0QY1q1L/lunges.gif',
                  equipment: 'Bodyweight',
                  difficulty: 'Beginner'
              }
          ],
          'Arms': [
              { 
                  id: 13, 
                  name: 'Barbell Bicep Curls', 
                  description: 'Stand holding barbell with underhand grip, hands shoulder-width apart. Curl barbell upward toward shoulders while keeping elbows close to body. Lower with control. Avoid swinging your body.',
                  gif: 'https://i.ibb.co/0QY1q1L/bicep-curl.gif',
                  equipment: 'Barbell',
                  difficulty: 'Beginner'
              },
              { 
                  id: 14, 
                  name: 'Tricep Dips', 
                  description: 'Use parallel bars or bench. Lower body by bending elbows until shoulders are slightly below elbows. Push back up to starting position. Keep body upright to target triceps more effectively.',
                  gif: 'https://i.ibb.co/0QY1q1L/tricep-dips.gif',
                  equipment: 'Parallel Bars/Bench',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 15, 
                  name: 'Hammer Curls', 
                  description: 'Hold dumbbells with palms facing each other. Curl one dumbbell up toward shoulder while keeping palm facing inward. Alternate arms. This targets both biceps and forearm muscles.',
                  gif: 'https://i.ibb.co/0QY1q1L/hammer-curl.gif',
                  equipment: 'Dumbbells',
                  difficulty: 'Beginner'
              }
          ],
          'Abs': [
              { 
                  id: 16, 
                  name: 'Crunches', 
                  description: 'Lie on back with knees bent, feet flat on floor. Place hands behind head without pulling on neck. Lift upper back off floor by contracting abs. Lower with control. Focus on using your abs, not neck muscles.',
                  gif: 'https://i.ibb.co/0QY1q1L/crunches.gif',
                  equipment: 'Mat',
                  difficulty: 'Beginner'
              },
              { 
                  id: 17, 
                  name: 'Leg Raises', 
                  description: 'Lie on back with legs extended. Place hands under lower back for support. Raise legs until perpendicular to floor, then lower slowly without touching floor. Keep movements controlled to maximize abdominal engagement.',
                  gif: 'https://i.ibb.co/0QY1q1L/leg-raises.gif',
                  equipment: 'Mat',
                  difficulty: 'Beginner'
              },
              { 
                  id: 18, 
                  name: 'Russian Twists', 
                  description: 'Sit on floor with knees bent, lean back slightly to engage core. Twist torso from side to side while keeping legs stable. For added difficulty, hold a weight or lift feet off floor.',
                  gif: 'https://i.ibb.co/0QY1q1L/russian-twists.gif',
                  equipment: 'Mat (optional weight)',
                  difficulty: 'Intermediate'
              }
          ]
      };

      // --- MAIN APP COMPONENT ---
      function App() {
        const [activeTab, setActiveTab] = useState('money');
        const [user, setUser] = useState(null);
        const [loading, setLoading] = useState(true);
        const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');
        const [lastSyncTime, setLastSyncTime] = useState(null);
        const [isSyncing, setIsSyncing] = useState(false);
        const [userId, setUserId] = useState(localStorage.getItem('userId') || '');
        const [showUserIdModal, setShowUserIdModal] = useState(false);
        const [newUserId, setNewUserId] = useState('');

        // Initialize theme
        useEffect(() => {
          document.documentElement.className = theme === 'dark' ? 'dark' : '';
          localStorage.setItem('theme', theme);
        }, [theme]);

        // Check authentication state
        useEffect(() => {
          if (!auth) {
            setLoading(false);
            return;
          }
          const unsubscribe = auth.onAuthStateChanged(async (user) => {
            if (user) {
              setUser(user);
              // Check if user has a user ID set
              const userRef = database.ref(`users/${user.uid}/userId`);
              const snapshot = await userRef.once('value');
              if (!snapshot.exists()) {
                setShowUserIdModal(true);
              } else {
                setUserId(snapshot.val());
                localStorage.setItem('userId', snapshot.val());
              }
              // Load initial data
              await loadInitialData(user.uid);
            } else {
              setUser(null);
            }
            setLoading(false);
          });
          return () => unsubscribe();
        }, []);

        // Set up periodic sync (every 10 minutes)
        useEffect(() => {
          if (user) {
            const syncInterval = setInterval(() => {
              syncData(user.uid);
            }, 10 * 60 * 1000); // 10 minutes
            
            return () => clearInterval(syncInterval);
          }
        }, [user]);

        const loadInitialData = async (uid) => {
          try {
            setIsSyncing(true);
            const snapshot = await database.ref(`userData/${uid}`).once('value');
            if (snapshot.exists()) {
              const data = snapshot.val();
              // Load data into localStorage
              Object.keys(data).forEach(key => {
                if (key !== 'lastSync') {
                  localStorage.setItem(key, JSON.stringify(data[key]));
                }
              });
            }
            setLastSyncTime(new Date().toLocaleTimeString());
          } catch (error) {
            console.error('Error loading data:', error);
          } finally {
            setIsSyncing(false);
          }
        };

        const syncData = async (uid) => {
          try {
            setIsSyncing(true);
            const dataToSync = {
              transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
              budgets: JSON.parse(localStorage.getItem('budgets') || '[]'),
              todoLists: JSON.parse(localStorage.getItem('todoLists') || '[]'),
              workoutProgress: JSON.parse(localStorage.getItem('workoutProgress') || '[]'),
              movies: JSON.parse(localStorage.getItem('movies') || '[]'),
              books: JSON.parse(localStorage.getItem('books') || '[]'),
              lastSync: new Date().toISOString()
            };
            
            await database.ref(`userData/${uid}`).set(dataToSync);
            setLastSyncTime(new Date().toLocaleTimeString());
          } catch (error) {
            console.error('Error syncing data:', error);
          } finally {
            setIsSyncing(false);
          }
        };

        const handleManualSync = () => {
          if (user) {
            syncData(user.uid);
          }
        };

        const handleSetUserId = async () => {
          if (!user || !newUserId.trim()) return;
          
          try {
            // Check if user ID is already taken
            const userRef = database.ref(`userIds/${newUserId}`);
            const snapshot = await userRef.once('value');
            
            if (snapshot.exists()) {
              alert('This User ID is already taken. Please choose another one.');
              return;
            }
            
            // Set user ID
            await userRef.set(user.uid);
            await database.ref(`users/${user.uid}/userId`).set(newUserId);
            
            setUserId(newUserId);
            localStorage.setItem('userId', newUserId);
            setShowUserIdModal(false);
            setNewUserId('');
          } catch (error) {
            console.error('Error setting user ID:', error);
            alert('Error setting User ID. Please try again.');
          }
        };

        if (loading) {
          return (
            <div className="min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center">
              <div className="text-center">
                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto"></div>
                <p className="mt-4 text-gray-600 dark:text-gray-400">Loading...</p>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
            {/* User ID Modal */}
            {showUserIdModal && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full">
                  <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
                    Set Your User ID
                  </h3>
                  <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Choose a permanent User ID that your friends can use to find you. This can only be set once.
                  </p>
                  <input
                    type="text"
                    value={newUserId}
                    onChange={(e) => setNewUserId(e.target.value)}
                    placeholder="Enter your User ID"
                    className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg mb-4 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                  />
                  <div className="flex gap-2">
                    <button
                      onClick={handleSetUserId}
                      className="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors"
                    >
                      Set User ID
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Header */}
            <header className="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex justify-between items-center h-16">
                  <div className="flex items-center">
                    <h1 className="text-xl font-bold text-gray-900 dark:text-white">Mero Jivan</h1>
                    {lastSyncTime && (
                      <span className="ml-4 text-xs text-gray-500 dark:text-gray-400">
                        Last sync: {lastSyncTime}
                      </span>
                    )}
                  </div>
                  <div className="flex items-center space-x-4">
                    <button
                      onClick={handleManualSync}
                      disabled={isSyncing}
                      className="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white disabled:opacity-50"
                      title="Sync Data"
                    >
                      <SyncIcon />
                    </button>
                    <button
                      onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
                      className="p-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"
                    >
                      {theme === 'dark' ? '‚òÄÔ∏è' : 'üåô'}
                    </button>
                    {user ? (
                      <div className="flex items-center space-x-2">
                        <span className="text-sm text-gray-700 dark:text-gray-300">
                          {user.displayName || user.email}
                        </span>
                        <button
                          onClick={() => auth.signOut()}
                          className="text-sm bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded transition-colors"
                        >
                          Logout
                        </button>
                      </div>
                    ) : (
                      <button
                        onClick={() => {
                          const provider = new firebase.auth.GoogleAuthProvider();
                          auth.signInWithPopup(provider);
                        }}
                        className="flex items-center space-x-2 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-2 px-4 rounded-lg transition-colors"
                      >
                        <GoogleIcon />
                        <span>Login with Google</span>
                      </button>
                    )}
                  </div>
                </div>
              </div>
            </header>

            {/* Navigation */}
            <nav className="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex space-x-8 overflow-x-auto">
                  {[
                    { id: 'money', name: 'Money', icon: MoneyIcon },
                    { id: 'life', name: 'Life', icon: LifeIcon },
                    { id: 'grow', name: 'Grow', icon: GrowIcon },
                    { id: 'messages', name: 'Messages', icon: MessageIcon },
                    { id: 'account', name: 'Account', icon: AccountIcon }
                  ].map((tab) => (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`flex items-center space-x-2 py-4 px-2 border-b-2 font-medium text-sm whitespace-nowrap transition-colors ${
                        activeTab === tab.id
                          ? 'border-green-500 text-green-600 dark:text-green-400'
                          : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'
                      }`}
                    >
                      <tab.icon />
                      <span>{tab.name}</span>
                    </button>
                  ))}
                </div>
              </div>
            </nav>

            {/* Main Content */}
            <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              {!user ? (
                <div className="text-center py-12">
                  <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                    Welcome to Mero Jivan
                  </h2>
                  <p className="text-gray-600 dark:text-gray-400 mb-8">
                    Please log in to start managing your finances, tasks, and personal growth.
                  </p>
                </div>
              ) : (
                <>
                  {activeTab === 'money' && <MoneyTab />}
                  {activeTab === 'life' && <LifeTab />}
                  {activeTab === 'grow' && <GrowTab />}
                  {activeTab === 'messages' && <MessagesTab userId={userId} />}
                  {activeTab === 'account' && <AccountTab userId={userId} />}
                </>
              )}
            </main>
          </div>
        );
      }

      // --- TAB COMPONENTS ---
      function MoneyTab() {
        const [transactions, setTransactions] = useState(() => JSON.parse(localStorage.getItem('transactions') || '[]'));
        const [budgets, setBudgets] = useState(() => JSON.parse(localStorage.getItem('budgets') || '[]'));
        const [showAddTransaction, setShowAddTransaction] = useState(false);
        const [showAddBudget, setShowAddBudget] = useState(false);
        const [newTransaction, setNewTransaction] = useState({ type: 'expense', category: 'food', amount: '', description: '', date: new Date().toISOString().split('T')[0] });
        const [newBudget, setNewBudget] = useState({ category: 'food', amount: '', month: new Date().getMonth() + 1, year: new Date().getFullYear() });
        const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);
        const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());

        const nepaliDate = gregorianToNepali(new Date().toISOString().split('T')[0]);

        const saveTransactions = (newTransactions) => {
          setTransactions(newTransactions);
          localStorage.setItem('transactions', JSON.stringify(newTransactions));
        };

        const saveBudgets = (newBudgets) => {
          setBudgets(newBudgets);
          localStorage.setItem('budgets', JSON.stringify(newBudgets));
        };

        const addTransaction = () => {
          if (!newTransaction.amount || !newTransaction.description) return;
          const transaction = {
            id: Date.now(),
            ...newTransaction,
            amount: parseFloat(newTransaction.amount),
            date: newTransaction.date
          };
          const updatedTransactions = [...transactions, transaction];
          saveTransactions(updatedTransactions);
          setNewTransaction({ type: 'expense', category: 'food', amount: '', description: '', date: new Date().toISOString().split('T')[0] });
          setShowAddTransaction(false);
        };

        const addBudget = () => {
          if (!newBudget.amount || !newBudget.category) return;
          const budget = {
            id: Date.now(),
            ...newBudget,
            amount: parseFloat(newBudget.amount)
          };
          const updatedBudgets = [...budgets, budget];
          saveBudgets(updatedBudgets);
          setNewBudget({ category: 'food', amount: '', month: new Date().getMonth() + 1, year: new Date().getFullYear() });
          setShowAddBudget(false);
        };

        const deleteTransaction = (id) => {
          const updatedTransactions = transactions.filter(t => t.id !== id);
          saveTransactions(updatedTransactions);
        };

        const deleteBudget = (id) => {
          const updatedBudgets = budgets.filter(b => b.id !== id);
          saveBudgets(updatedBudgets);
        };

        const filteredTransactions = transactions.filter(t => {
          const date = new Date(t.date);
          return date.getMonth() + 1 === selectedMonth && date.getFullYear() === selectedYear;
        });

        const currentBudget = budgets.find(b => b.month === selectedMonth && b.year === selectedYear);
        const totalExpenses = filteredTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        const totalIncome = filteredTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const balance = totalIncome - totalExpenses;
        const budgetUsage = currentBudget ? (totalExpenses / currentBudget.amount) * 100 : 0;

        return (
          <div className="space-y-6">
            {/* Summary Cards */}
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700">
                <p className="text-sm text-gray-600 dark:text-gray-400">Balance</p>
                <p className={`text-2xl font-bold ${balance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                  Rs. {balance.toFixed(2)}
                </p>
              </div>
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700">
                <p className="text-sm text-gray-600 dark:text-gray-400">Income</p>
                <p className="text-2xl font-bold text-green-600">Rs. {totalIncome.toFixed(2)}</p>
              </div>
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700">
                <p className="text-sm text-gray-600 dark:text-gray-400">Expenses</p>
                <p className="text-2xl font-bold text-red-600">Rs. {totalExpenses.toFixed(2)}</p>
              </div>
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700">
                <p className="text-sm text-gray-600 dark:text-gray-400">Budget Usage</p>
                <p className="text-2xl font-bold text-blue-600">{budgetUsage.toFixed(1)}%</p>
              </div>
            </div>

            {/* Month/Year Selector */}
            <div className="flex items-center space-x-4">
              <select
                value={selectedMonth}
                onChange={(e) => setSelectedMonth(parseInt(e.target.value))}
                className="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-gray-900 dark:text-white"
              >
                {NEPALI_MONTHS.map((month, index) => (
                  <option key={index + 1} value={index + 1}>{month}</option>
                ))}
              </select>
              <select
                value={selectedYear}
                onChange={(e) => setSelectedYear(parseInt(e.target.value))}
                className="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-gray-900 dark:text-white"
              >
                {Object.keys(NEPALI_YEAR_START_GREGORIAN_DATE).map(year => (
                  <option key={year} value={year}>{year}</option>
                ))}
              </select>
              <span className="text-sm text-gray-600 dark:text-gray-400">
                {nepaliDate.monthName} {nepaliDate.year}, {nepaliDate.day}
              </span>
            </div>

            {/* Action Buttons */}
            <div className="flex space-x-4">
              <button
                onClick={() => setShowAddTransaction(true)}
                className="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors flex items-center space-x-2"
              >
                <PlusIcon />
                <span>Add Transaction</span>
              </button>
              <button
                onClick={() => setShowAddBudget(true)}
                className="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors flex items-center space-x-2"
              >
                <PlusIcon />
                <span>Set Budget</span>
              </button>
            </div>

            {/* Add Transaction Modal */}
            {showAddTransaction && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full">
                  <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Add Transaction</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type</label>
                      <select
                        value={newTransaction.type}
                        onChange={(e) => setNewTransaction({...newTransaction, type: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                      <select
                        value={newTransaction.category}
                        onChange={(e) => setNewTransaction({...newTransaction, category: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        {(newTransaction.type === 'expense' ? CATEGORIES.expense : CATEGORIES.income).map(cat => (
                          <option key={cat.id} value={cat.id}>{cat.name}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount (Rs.)</label>
                      <input
                        type="number"
                        value={newTransaction.amount}
                        onChange={(e) => setNewTransaction({...newTransaction, amount: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        placeholder="0.00"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description</label>
                      <input
                        type="text"
                        value={newTransaction.description}
                        onChange={(e) => setNewTransaction({...newTransaction, description: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        placeholder="Enter description"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
                      <input
                        type="date"
                        value={newTransaction.date}
                        onChange={(e) => setNewTransaction({...newTransaction, date: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      />
                    </div>
                  </div>
                  <div className="flex justify-end space-x-2 mt-6">
                    <button
                      onClick={() => setShowAddTransaction(false)}
                      className="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={addTransaction}
                      className="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors"
                    >
                      Add
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Add Budget Modal */}
            {showAddBudget && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full">
                  <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Set Budget</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                      <select
                        value={newBudget.category}
                        onChange={(e) => setNewBudget({...newBudget, category: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        {CATEGORIES.expense.map(cat => (
                          <option key={cat.id} value={cat.id}>{cat.name}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount (Rs.)</label>
                      <input
                        type="number"
                        value={newBudget.amount}
                        onChange={(e) => setNewBudget({...newBudget, amount: e.target.value})}
                        className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        placeholder="0.00"
                      />
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Month</label>
                        <select
                          value={newBudget.month}
                          onChange={(e) => setNewBudget({...newBudget, month: parseInt(e.target.value)})}
                          className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        >
                          {NEPALI_MONTHS.map((month, index) => (
                            <option key={index + 1} value={index + 1}>{month}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Year</label>
                        <select
                          value={newBudget.year}
                          onChange={(e) => setNewBudget({...newBudget, year: parseInt(e.target.value)})}
                          className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                        >
                          {Object.keys(NEPALI_YEAR_START_GREGORIAN_DATE).map(year => (
                            <option key={year} value={year}>{year}</option>
                          ))}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div className="flex justify-end space-x-2 mt-6">
                    <button
                      onClick={() => setShowAddBudget(false)}
                      className="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={addBudget}
                      className="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors"
                    >
                      Set Budget
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Transactions List */}
            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
              <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Recent Transactions</h3>
              </div>
              <div className="divide-y divide-gray-200 dark:divide-gray-700">
                {filteredTransactions.length === 0 ? (
                  <div className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                    No transactions for selected period
                  </div>
                ) : (
                  filteredTransactions.map((transaction) => {
                    const category = ALL_CATEGORIES[transaction.category];
                    const Icon = category?.Icon || OtherIcon;
                    return (
                      <div key={transaction.id} className="px-6 py-4 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                          <div className="p-2 rounded-full bg-gray-100 dark:bg-gray-700">
                            <Icon />
                          </div>
                          <div>
                            <p className="font-medium text-gray-900 dark:text-white">{transaction.description}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">{category?.name} ‚Ä¢ {new Date(transaction.date).toLocaleDateString()}</p>
                          </div>
                        </div>
                        <div className="flex items-center space-x-4">
                          <p className={`font-semibold ${transaction.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                            {transaction.type === 'income' ? '+' : '-'}Rs. {transaction.amount.toFixed(2)}
                          </p>
                          <button
                            onClick={() => deleteTransaction(transaction.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      </div>
                    );
                  })
                )}
              </div>
            </div>

            {/* Budgets List */}
            {budgets.length > 0 && (
              <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                  <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Budgets</h3>
                </div>
                <div className="divide-y divide-gray-200 dark:divide-gray-700">
                  {budgets.map((budget) => {
                    const category = ALL_CATEGORIES[budget.category];
                    const Icon = category?.Icon || OtherIcon;
                    const monthTransactions = transactions.filter(t => 
                      t.type === 'expense' && 
                      t.category === budget.category && 
                      new Date(t.date).getMonth() + 1 === budget.month &&
                      new Date(t.date).getFullYear() === budget.year
                    );
                    const spent = monthTransactions.reduce((sum, t) => sum + t.amount, 0);
                    const usage = (spent / budget.amount) * 100;
                    
                    return (
                      <div key={budget.id} className="px-6 py-4 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                          <div className="p-2 rounded-full bg-gray-100 dark:bg-gray-700">
                            <Icon />
                          </div>
                          <div>
                            <p className="font-medium text-gray-900 dark:text-white">{category?.name}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">
                              {NEPALI_MONTHS[budget.month - 1]} {budget.year}
                            </p>
                            <div className="w-32 bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-1">
                              <div 
                                className={`h-2 rounded-full ${usage > 100 ? 'bg-red-500' : usage > 80 ? 'bg-yellow-500' : 'bg-green-500'}`}
                                style={{ width: `${Math.min(usage, 100)}%` }}
                              ></div>
                            </div>
                          </div>
                        </div>
                        <div className="flex items-center space-x-4">
                          <p className="text-sm text-gray-600 dark:text-gray-400">
                            Rs. {spent.toFixed(2)} / Rs. {budget.amount.toFixed(2)}
                          </p>
                          <button
                            onClick={() => deleteBudget(budget.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
        );
      }

      function LifeTab() {
        const [activeSection, setActiveSection] = useState('todo');
        const [todoLists, setTodoLists] = useState(() => JSON.parse(localStorage.getItem('todoLists') || '[]'));
        const [movies, setMovies] = useState(() => JSON.parse(localStorage.getItem('movies') || '[]'));
        const [books, setBooks] = useState(() => JSON.parse(localStorage.getItem('books') || '[]'));
        const [newTodo, setNewTodo] = useState('');
        const [newMovie, setNewMovie] = useState({ title: '', type: 'watched', rating: 5 });
        const [newBook, setNewBook] = useState({ title: '', type: 'read', rating: 5 });

        const saveTodos = (newTodos) => {
          setTodoLists(newTodos);
          localStorage.setItem('todoLists', JSON.stringify(newTodos));
        };

        const saveMovies = (newMovies) => {
          setMovies(newMovies);
          localStorage.setItem('movies', JSON.stringify(newMovies));
        };

        const saveBooks = (newBooks) => {
          setBooks(newBooks);
          localStorage.setItem('books', JSON.stringify(newBooks));
        };

        const addTodo = () => {
          if (!newTodo.trim()) return;
          const todo = {
            id: Date.now(),
            text: newTodo,
            completed: false,
            createdAt: new Date().toISOString()
          };
          const updatedTodos = [...todoLists, todo];
          saveTodos(updatedTodos);
          setNewTodo('');
        };

        const addMovie = () => {
          if (!newMovie.title.trim()) return;
          const movie = {
            id: Date.now(),
            ...newMovie,
            createdAt: new Date().toISOString()
          };
          const updatedMovies = [...movies, movie];
          saveMovies(updatedMovies);
          setNewMovie({ title: '', type: 'watched', rating: 5 });
        };

        const addBook = () => {
          if (!newBook.title.trim()) return;
          const book = {
            id: Date.now(),
            ...newBook,
            createdAt: new Date().toISOString()
          };
          const updatedBooks = [...books, book];
          saveBooks(updatedBooks);
          setNewBook({ title: '', type: 'read', rating: 5 });
        };

        const toggleTodo = (id) => {
          const updatedTodos = todoLists.map(todo =>
            todo.id === id ? { ...todo, completed: !todo.completed } : todo
          );
          saveTodos(updatedTodos);
        };

        const deleteTodo = (id) => {
          const updatedTodos = todoLists.filter(todo => todo.id !== id);
          saveTodos(updatedTodos);
        };

        const deleteMovie = (id) => {
          const updatedMovies = movies.filter(movie => movie.id !== id);
          saveMovies(updatedMovies);
        };

        const deleteBook = (id) => {
          const updatedBooks = books.filter(book => book.id !== id);
          saveBooks(updatedBooks);
        };

        return (
          <div className="space-y-6">
            {/* Section Navigation */}
            <div className="flex space-x-4 border-b border-gray-200 dark:border-gray-700">
              {[
                { id: 'todo', name: 'To-Do List', icon: null },
                { id: 'movies', name: 'Movies/Series', icon: MovieIcon },
                { id: 'books', name: 'Books', icon: BookIcon }
              ].map((section) => (
                <button
                  key={section.id}
                  onClick={() => setActiveSection(section.id)}
                  className={`flex items-center space-x-2 py-3 px-4 border-b-2 font-medium text-sm transition-colors ${
                    activeSection === section.id
                      ? 'border-green-500 text-green-600 dark:text-green-400'
                      : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'
                  }`}
                >
                  {section.icon && <section.icon />}
                  <span>{section.name}</span>
                </button>
              ))}
            </div>

            {/* To-Do List Section */}
            {activeSection === 'todo' && (
              <div className="space-y-4">
                <div className="flex space-x-4">
                  <input
                    type="text"
                    value={newTodo}
                    onChange={(e) => setNewTodo(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && addTodo()}
                    placeholder="Add a new task..."
                    className="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                  />
                  <button
                    onClick={addTodo}
                    className="bg-green-500 hover:bg-green-600 text-white py-2 px-6 rounded-lg transition-colors"
                  >
                    Add
                  </button>
                </div>

                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                  <div className="divide-y divide-gray-200 dark:divide-gray-700">
                    {todoLists.length === 0 ? (
                      <div className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                        No tasks yet. Add your first task!
                      </div>
                    ) : (
                      todoLists.map((todo) => (
                        <div key={todo.id} className="px-6 py-4 flex items-center justify-between">
                          <div className="flex items-center space-x-3">
                            <input
                              type="checkbox"
                              checked={todo.completed}
                              onChange={() => toggleTodo(todo.id)}
                              className="h-5 w-5 text-green-500 rounded border-gray-300 focus:ring-green-500"
                            />
                            <span className={`${todo.completed ? 'line-through text-gray-500' : 'text-gray-900 dark:text-white'}`}>
                              {todo.text}
                            </span>
                          </div>
                          <button
                            onClick={() => deleteTodo(todo.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* Movies/Series Section */}
            {activeSection === 'movies' && (
              <div className="space-y-4">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700">
                  <h4 className="font-semibold mb-3 text-gray-900 dark:text-white">Add Movie/Series</h4>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <input
                      type="text"
                      value={newMovie.title}
                      onChange={(e) => setNewMovie({...newMovie, title: e.target.value})}
                      placeholder="Title"
                      className="md:col-span-2 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                    />
                    <select
                      value={newMovie.type}
                      onChange={(e) => setNewMovie({...newMovie, type: e.target.value})}
                      className="p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                    >
                      <option value="watched">Watched</option>
                      <option value="watchlist">Watchlist</option>
                    </select>
                    <div className="flex space-x-2">
                      <select
                        value={newMovie.rating}
                        onChange={(e) => setNewMovie({...newMovie, rating: parseInt(e.target.value)})}
                        className="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        {[1,2,3,4,5,6,7,8,9,10].map(num => (
                          <option key={num} value={num}>{num} ‚òÖ</option>
                        ))}
                      </select>
                      <button
                        onClick={addMovie}
                        className="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors"
                      >
                        Add
                      </button>
                    </div>
                  </div>
                </div>

                {/* Watched Movies */}
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                  <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h4 className="font-semibold text-gray-900 dark:text-white">Watched ({movies.filter(m => m.type === 'watched').length})</h4>
                  </div>
                  <div className="divide-y divide-gray-200 dark:divide-gray-700">
                    {movies.filter(m => m.type === 'watched').length === 0 ? (
                      <div className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                        No watched movies/series yet.
                      </div>
                    ) : (
                      movies.filter(m => m.type === 'watched').map((movie) => (
                        <div key={movie.id} className="px-6 py-4 flex items-center justify-between">
                          <div>
                            <p className="font-medium text-gray-900 dark:text-white">{movie.title}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">
                              Rated: {'‚òÖ'.repeat(movie.rating)}{'‚òÜ'.repeat(10 - movie.rating)}
                            </p>
                          </div>
                          <button
                            onClick={() => deleteMovie(movie.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                </div>

                {/* Watchlist */}
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                  <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h4 className="font-semibold text-gray-900 dark:text-white">Watchlist ({movies.filter(m => m.type === 'watchlist').length})</h4>
                  </div>
                  <div className="divide-y divide-gray-200 dark:divide-gray-700">
                    {movies.filter(m => m.type === 'watchlist').length === 0 ? (
                      <div className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                        Your watchlist is empty.
                      </div>
                    ) : (
                      movies.filter(m => m.type === 'watchlist').map((movie) => (
                        <div key={movie.id} className="px-6 py-4 flex items-center justify-between">
                          <div>
                            <p className="font-medium text-gray-900 dark:text-white">{movie.title}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">
                              To watch
                            </p>
                          </div>
                          <button
                            onClick={() => deleteMovie(movie.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* Books Section */}
            {activeSection === 'books' && (
              <div className="space-y-4">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700">
                  <h4 className="font-semibold mb-3 text-gray-900 dark:text-white">Add Book</h4>
                  <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                    <input
                      type="text"
                      value={newBook.title}
                      onChange={(e) => setNewBook({...newBook, title: e.target.value})}
                      placeholder="Title"
                      className="md:col-span-2 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                    />
                    <select
                      value={newBook.type}
                      onChange={(e) => setNewBook({...newBook, type: e.target.value})}
                      className="p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                    >
                      <option value="read">Read</option>
                      <option value="readlist">To Read</option>
                    </select>
                    <div className="flex space-x-2">
                      <select
                        value={newBook.rating}
                        onChange={(e) => setNewBook({...newBook, rating: parseInt(e.target.value)})}
                        className="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      >
                        {[1,2,3,4,5,6,7,8,9,10].map(num => (
                          <option key={num} value={num}>{num} ‚òÖ</option>
                        ))}
                      </select>
                      <button
                        onClick={addBook}
                        className="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors"
                      >
                        Add
                      </button>
                    </div>
                  </div>
                </div>

                {/* Read Books */}
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                  <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h4 className="font-semibold text-gray-900 dark:text-white">Read ({books.filter(b => b.type === 'read').length})</h4>
                  </div>
                  <div className="divide-y divide-gray-200 dark:divide-gray-700">
                    {books.filter(b => b.type === 'read').length === 0 ? (
                      <div className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                        No books read yet.
                      </div>
                    ) : (
                      books.filter(b => b.type === 'read').map((book) => (
                        <div key={book.id} className="px-6 py-4 flex items-center justify-between">
                          <div>
                            <p className="font-medium text-gray-900 dark:text-white">{book.title}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">
                              Rated: {'‚òÖ'.repeat(book.rating)}{'‚òÜ'.repeat(10 - book.rating)}
                            </p>
                          </div>
                          <button
                            onClick={() => deleteBook(book.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                </div>

                {/* Reading List */}
                <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                  <div className="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h4 className="font-semibold text-gray-900 dark:text-white">To Read ({books.filter(b => b.type === 'readlist').length})</h4>
                  </div>
                  <div className="divide-y divide-gray-200 dark:divide-gray-700">
                    {books.filter(b => b.type === 'readlist').length === 0 ? (
                      <div className="px-6 py-8 text-center text-gray-500 dark:text-gray-400">
                        Your reading list is empty.
                      </div>
                    ) : (
                      books.filter(b => b.type === 'readlist').map((book) => (
                        <div key={book.id} className="px-6 py-4 flex items-center justify-between">
                          <div>
                            <p className="font-medium text-gray-900 dark:text-white">{book.title}</p>
                            <p className="text-sm text-gray-500 dark:text-gray-400">
                              To read
                            </p>
                          </div>
                          <button
                            onClick={() => deleteBook(book.id)}
                            className="text-red-500 hover:text-red-700 transition-colors"
                          >
                            <DeleteIcon />
                          </button>
                        </div>
                      ))
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      }

      function GrowTab() {
        const [workoutProgress, setWorkoutProgress] = useState(() => JSON.parse(localStorage.getItem('workoutProgress') || '[]'));
        const [selectedMuscleGroup, setSelectedMuscleGroup] = useState('Chest');
        const [selectedExercise, setSelectedExercise] = useState(null);
        const [showExerciseDetail, setShowExerciseDetail] = useState(false);

        const saveWorkoutProgress = (newProgress) => {
          setWorkoutProgress(newProgress);
          localStorage.setItem('workoutProgress', JSON.stringify(newProgress));
        };

        const logWorkout = (exerciseId, sets, reps, weight) => {
          const progress = {
            id: Date.now(),
            exerciseId,
            sets,
            reps,
            weight,
            date: new Date().toISOString()
          };
          const updatedProgress = [...workoutProgress, progress];
          saveWorkoutProgress(updatedProgress);
        };

        const getRecentProgress = (exerciseId) => {
          return workoutProgress
            .filter(p => p.exerciseId === exerciseId)
            .sort((a, b) => new Date(b.date) - new Date(a.date))
            .slice(0, 3);
        };

        return (
          <div className="space-y-6">
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              {/* Muscle Groups */}
              <div className="lg:col-span-1 space-y-4">
                <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Muscle Groups</h3>
                <div className="grid grid-cols-2 gap-3">
                  {Object.keys(WORKOUT_DATA).map((muscleGroup) => (
                    <button
                      key={muscleGroup}
                      onClick={() => setSelectedMuscleGroup(muscleGroup)}
                      className={`p-4 rounded-lg border-2 transition-colors ${
                        selectedMuscleGroup === muscleGroup
                          ? 'border-green-500 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300'
                          : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600'
                      }`}
                    >
                      <span className="font-medium">{muscleGroup}</span>
                    </button>
                  ))}
                </div>
              </div>

              {/* Exercises */}
              <div className="lg:col-span-2 space-y-4">
                <h3 className="text-lg font-semibold text-gray-900 dark:text-white">Exercises - {selectedMuscleGroup}</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {WORKOUT_DATA[selectedMuscleGroup]?.map((exercise) => (
                    <div
                      key={exercise.id}
                      className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-200 dark:border-gray-700 cursor-pointer hover:shadow-md transition-shadow"
                      onClick={() => {
                        setSelectedExercise(exercise);
                        setShowExerciseDetail(true);
                      }}
                    >
                      <div className="flex items-start justify-between">
                        <div>
                          <h4 className="font-semibold text-gray-900 dark:text-white">{exercise.name}</h4>
                          <p className="text-sm text-gray-500 dark:text-gray-400 mt-1">{exercise.equipment}</p>
                          <span className={`inline-block px-2 py-1 text-xs rounded-full mt-2 ${
                            exercise.difficulty === 'Beginner' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' :
                            exercise.difficulty === 'Intermediate' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300' :
                            'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
                          }`}>
                            {exercise.difficulty}
                          </span>
                        </div>
                      </div>
                      
                      {/* Recent Progress */}
                      <div className="mt-3">
                        <p className="text-xs text-gray-500 dark:text-gray-400 mb-2">Recent Progress:</p>
                        {getRecentProgress(exercise.id).length === 0 ? (
                          <p className="text-xs text-gray-400 dark:text-gray-500">No workouts logged yet</p>
                        ) : (
                          getRecentProgress(exercise.id).map((progress, index) => (
                            <div key={index} className="text-xs text-gray-600 dark:text-gray-400">
                              {progress.sets}√ó{progress.reps} @ {progress.weight}kg
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Exercise Detail Modal */}
            {showExerciseDetail && selectedExercise && (
              <ExerciseDetailModal
                exercise={selectedExercise}
                onClose={() => setShowExerciseDetail(false)}
                onLogWorkout={logWorkout}
                recentProgress={getRecentProgress(selectedExercise.id)}
              />
            )}
          </div>
        );
      }

      function ExerciseDetailModal({ exercise, onClose, onLogWorkout, recentProgress }) {
        const [sets, setSets] = useState(3);
        const [reps, setReps] = useState(10);
        const [weight, setWeight] = useState(20);

        const handleLogWorkout = () => {
          onLogWorkout(exercise.id, sets, reps, weight);
          onClose();
        };

        return (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
              <div className="p-6">
                <div className="flex justify-between items-start mb-4">
                  <h3 className="text-xl font-bold text-gray-900 dark:text-white">{exercise.name}</h3>
                  <button onClick={onClose} className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    ‚úï
                  </button>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <div>
                    <img
                      src={exercise.gif}
                      alt={exercise.name}
                      className="w-full h-64 object-cover rounded-lg"
                      onError={(e) => {
                        e.target.src = 'https://via.placeholder.com/300x200/3B82F6/FFFFFF?text=Exercise+Demonstration';
                      }}
                    />
                    
                    <div className="mt-4 space-y-3">
                      <div>
                        <span className="font-semibold text-gray-700 dark:text-gray-300">Equipment:</span>
                        <span className="ml-2 text-gray-600 dark:text-gray-400">{exercise.equipment}</span>
                      </div>
                      <div>
                        <span className="font-semibold text-gray-700 dark:text-gray-300">Difficulty:</span>
                        <span className={`ml-2 px-2 py-1 text-xs rounded-full ${
                          exercise.difficulty === 'Beginner' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' :
                          exercise.difficulty === 'Intermediate' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300' :
                          'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300'
                        }`}>
                          {exercise.difficulty}
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-6">
                    <div>
                      <h4 className="font-semibold text-gray-900 dark:text-white mb-2">Description</h4>
                      <p className="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
                        {exercise.description}
                      </p>
                    </div>

                    {/* Recent Progress */}
                    {recentProgress.length > 0 && (
                      <div>
                        <h4 className="font-semibold text-gray-900 dark:text-white mb-2">Recent Progress</h4>
                        <div className="space-y-2">
                          {recentProgress.map((progress, index) => (
                            <div key={index} className="flex justify-between text-sm text-gray-600 dark:text-gray-400">
                              <span>{new Date(progress.date).toLocaleDateString()}</span>
                              <span>{progress.sets} sets √ó {progress.reps} reps @ {progress.weight}kg</span>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {/* Log Workout */}
                    <div>
                      <h4 className="font-semibold text-gray-900 dark:text-white mb-3">Log Workout</h4>
                      <div className="grid grid-cols-3 gap-3">
                        <div>
                          <label className="block text-xs text-gray-500 dark:text-gray-400 mb-1">Sets</label>
                          <input
                            type="number"
                            value={sets}
                            onChange={(e) => setSets(parseInt(e.target.value) || 0)}
                            className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                            min="1"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-500 dark:text-gray-400 mb-1">Reps</label>
                          <input
                            type="number"
                            value={reps}
                            onChange={(e) => setReps(parseInt(e.target.value) || 0)}
                            className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                            min="1"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-500 dark:text-gray-400 mb-1">Weight (kg)</label>
                          <input
                            type="number"
                            value={weight}
                            onChange={(e) => setWeight(parseFloat(e.target.value) || 0)}
                            className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                            min="0"
                            step="0.5"
                          />
                        </div>
                      </div>
                      <button
                        onClick={handleLogWorkout}
                        className="w-full mt-4 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors"
                      >
                        Log Workout
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function MessagesTab({ userId }) {
        const [friends, setFriends] = useState([]);
        const [friendRequests, setFriendRequests] = useState([]);
        const [activeChat, setActiveChat] = useState(null);
        const [messages, setMessages] = useState([]);
        const [newMessage, setNewMessage] = useState('');
        const [searchUserId, setSearchUserId] = useState('');

        // Load friends and messages from Firebase
        useEffect(() => {
          if (!userId) return;

          // Load friends list
          const friendsRef = database.ref(`friends/${userId}`);
          friendsRef.on('value', (snapshot) => {
            const friendsData = snapshot.val() || {};
            setFriends(Object.keys(friendsData).map(friendId => ({
              id: friendId,
              ...friendsData[friendId]
            })));
          });

          // Load friend requests
          const requestsRef = database.ref(`friendRequests/${userId}`);
          requestsRef.on('value', (snapshot) => {
            const requestsData = snapshot.val() || {};
            setFriendRequests(Object.keys(requestsData).map(requestId => ({
              id: requestId,
              ...requestsData[requestId]
            })));
          });

          return () => {
            friendsRef.off();
            requestsRef.off();
          };
        }, [userId]);

        const sendFriendRequest = async () => {
          if (!searchUserId.trim() || searchUserId === userId) return;

          try {
            // Check if user exists
            const userRef = database.ref(`userIds/${searchUserId}`);
            const snapshot = await userRef.once('value');
            
            if (!snapshot.exists()) {
              alert('User not found');
              return;
            }

            const targetUserId = snapshot.val();

            // Check if already friends or request pending
            const existingRequestRef = database.ref(`friendRequests/${targetUserId}/${userId}`);
            const existingRequest = await existingRequestRef.once('value');
            
            if (existingRequest.exists()) {
              alert('Friend request already sent');
              return;
            }

            // Send friend request
            await existingRequestRef.set({
              from: userId,
              timestamp: Date.now(),
              status: 'pending'
            });

            setSearchUserId('');
            alert('Friend request sent!');
          } catch (error) {
            console.error('Error sending friend request:', error);
            alert('Error sending friend request');
          }
        };

        const acceptFriendRequest = async (requestId, fromUserId) => {
          try {
            // Add to friends list for both users
            await database.ref(`friends/${userId}/${fromUserId}`).set({
              userId: fromUserId,
              timestamp: Date.now()
            });
            
            await database.ref(`friends/${fromUserId}/${userId}`).set({
              userId: userId,
              timestamp: Date.now()
            });

            // Remove the request
            await database.ref(`friendRequests/${userId}/${requestId}`).remove();
          } catch (error) {
            console.error('Error accepting friend request:', error);
          }
        };

        const rejectFriendRequest = async (requestId) => {
          try {
            await database.ref(`friendRequests/${userId}/${requestId}`).remove();
          } catch (error) {
            console.error('Error rejecting friend request:', error);
          }
        };

        const sendMessage = async () => {
          if (!newMessage.trim() || !activeChat) return;

          try {
            const messageId = Date.now().toString();
            const messageData = {
              id: messageId,
              from: userId,
              to: activeChat.userId,
              text: newMessage,
              timestamp: Date.now(),
              read: false
            };

            // Save message to both users' chat
            await database.ref(`messages/${userId}/${activeChat.userId}/${messageId}`).set(messageData);
            await database.ref(`messages/${activeChat.userId}/${userId}/${messageId}`).set(messageData);

            setNewMessage('');
          } catch (error) {
            console.error('Error sending message:', error);
          }
        };

        return (
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]">
            {/* Friends Sidebar */}
            <div className="lg:col-span-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
              <div className="p-4 border-b border-gray-200 dark:border-gray-700">
                <h3 className="font-semibold text-gray-900 dark:text-white">Friends</h3>
                
                {/* Add Friend */}
                <div className="mt-3 flex space-x-2">
                  <input
                    type="text"
                    value={searchUserId}
                    onChange={(e) => setSearchUserId(e.target.value)}
                    placeholder="Enter User ID"
                    className="flex-1 p-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                  />
                  <button
                    onClick={sendFriendRequest}
                    className="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm transition-colors"
                  >
                    Add
                  </button>
                </div>
              </div>

              {/* Friend Requests */}
              {friendRequests.length > 0 && (
                <div className="p-4 border-b border-gray-200 dark:border-gray-700">
                  <h4 className="font-medium text-gray-900 dark:text-white mb-2">Friend Requests</h4>
                  <div className="space-y-2">
                    {friendRequests.map(request => (
                      <div key={request.id} className="flex items-center justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                        <span className="text-sm text-gray-600 dark:text-gray-300">{request.from}</span>
                        <div className="flex space-x-1">
                          <button
                            onClick={() => acceptFriendRequest(request.id, request.from)}
                            className="text-green-500 hover:text-green-700 text-sm"
                          >
                            Accept
                          </button>
                          <button
                            onClick={() => rejectFriendRequest(request.id)}
                            className="text-red-500 hover:text-red-700 text-sm"
                          >
                            Reject
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Friends List */}
              <div className="p-4">
                <h4 className="font-medium text-gray-900 dark:text-white mb-2">Friends ({friends.length})</h4>
                <div className="space-y-2">
                  {friends.length === 0 ? (
                    <p className="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
                      No friends yet. Add some friends to start chatting!
                    </p>
                  ) : (
                    friends.map(friend => (
                      <button
                        key={friend.userId}
                        onClick={() => setActiveChat(friend)}
                        className={`w-full text-left p-3 rounded-lg transition-colors ${
                          activeChat?.userId === friend.userId
                            ? 'bg-green-100 dark:bg-green-900/20 text-green-900 dark:text-green-100'
                            : 'hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300'
                        }`}
                      >
                        <div className="flex items-center space-x-3">
                          <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                            {friend.userId?.charAt(0).toUpperCase()}
                          </div>
                          <span className="font-medium">{friend.userId}</span>
                        </div>
                      </button>
                    ))
                  )}
                </div>
              </div>
            </div>

            {/* Chat Area */}
            <div className="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col">
              {activeChat ? (
                <>
                  <div className="p-4 border-b border-gray-200 dark:border-gray-700">
                    <h3 className="font-semibold text-gray-900 dark:text-white">{activeChat.userId}</h3>
                  </div>
                  
                  <div className="flex-1 p-4 overflow-y-auto custom-scrollbar">
                    {/* Messages will be loaded here */}
                    <div className="text-center text-gray-500 dark:text-gray-400 py-8">
                      Chat feature will be implemented with real-time messaging
                    </div>
                  </div>
                  
                  <div className="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div className="flex space-x-2">
                      <input
                        type="text"
                        value={newMessage}
                        onChange={(e) => setNewMessage(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                        placeholder="Type a message..."
                        className="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                      />
                      <button
                        onClick={sendMessage}
                        className="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition-colors"
                      >
                        Send
                      </button>
                    </div>
                  </div>
                </>
              ) : (
                <div className="flex-1 flex items-center justify-center text-gray-500 dark:text-gray-400">
                  Select a friend to start chatting
                </div>
              )}
            </div>
          </div>
        );
      }

      function AccountTab({ userId }) {
        const [userData, setUserData] = useState({
          displayName: '',
          email: '',
          createdAt: ''
        });

        useEffect(() => {
          const user = auth?.currentUser;
          if (user) {
            setUserData({
              displayName: user.displayName || 'Not set',
              email: user.email,
              createdAt: user.metadata.creationTime
            });
          }
        }, []);

        return (
          <div className="max-w-2xl mx-auto space-y-6">
            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-6">Account Information</h3>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    User ID
                  </label>
                  <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white">
                    {userId || 'Not set'}
                  </div>
                  <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    Share this ID with friends to connect with them
                  </p>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Display Name
                  </label>
                  <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white">
                    {userData.displayName}
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Email
                  </label>
                  <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white">
                    {userData.email}
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Account Created
                  </label>
                  <div className="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white">
                    {userData.createdAt ? new Date(userData.createdAt).toLocaleDateString() : 'N/A'}
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">Data Management</h3>
              
              <div className="space-y-3">
                <button
                  onClick={() => {
                    if (confirm('Are you sure you want to clear all local data? This cannot be undone.')) {
                      localStorage.clear();
                      window.location.reload();
                    }
                  }}
                  className="w-full text-left p-3 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors"
                >
                  Clear All Local Data
                </button>
                
                <button
                  onClick={() => {
                    if (confirm('Are you sure you want to export your data?')) {
                      const data = {
                        transactions: JSON.parse(localStorage.getItem('transactions') || '[]'),
                        budgets: JSON.parse(localStorage.getItem('budgets') || '[]'),
                        todoLists: JSON.parse(localStorage.getItem('todoLists') || '[]'),
                        workoutProgress: JSON.parse(localStorage.getItem('workoutProgress') || '[]'),
                        movies: JSON.parse(localStorage.getItem('movies') || '[]'),
                        books: JSON.parse(localStorage.getItem('books') || '[]')
                      };
                      
                      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                      const url = URL.createObjectURL(blob);
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = `mero-jivan-backup-${new Date().toISOString().split('T')[0]}.json`;
                      a.click();
                      URL.revokeObjectURL(url);
                    }
                  }}
                  className="w-full text-left p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
                >
                  Export Data
                </button>
              </div>
            </div>
          </div>
        );
      }

      // Render the app
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
