<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Life Dashboard</title>
    <!-- PWA MANIFEST -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTWVybyBKaXZhbiIsInNob3J0X25hbWUiOiJNZXJvIEppdmFuIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMDY4OTBhIiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vcGxhY2Vob2xkLmNvLzEyOHgzMjgvMDY4OTBhL0ZGRiIsInNpemVzIjoiMTI4eDEyOCJ9XX0=">
    <meta name="theme-color" content="#06890a">
    <!-- NOTIFICATION PERMISSION -->
    <script>if ('Notification' in window && Notification.permission === 'default') Notification.requestPermission();</script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <style>
        /* Disable zoom on mobile */
        html, body {
            touch-action: pan-y;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* Allow scrolling */
        .scroll-container {
            -webkit-overflow-scrolling: touch;
        }
    </style>
</head>
<body class="scroll-container">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo, useRef } = React;

      // --- FIREBASE CONFIGURATION ---
      const firebaseConfig = {
        apiKey: "AIzaSyCwQVdSe_BvFgxwXd4oP6PPOuh6NrJaXNY",
        authDomain: "mero-jivan-cd3a6.firebaseapp.com",
        databaseURL: "https://mero-jivan-cd3a6-default-rtdb.firebaseio.com",
        projectId: "mero-jivan-cd3a6",
        storageBucket: "mero-jivan-cd3a6.firebasestorage.app",
        messagingSenderId: "244728705595",
        appId: "1:244728705595:web:dddc0a53d7cae21bbba21e",
        measurementId: "G-3RVXWQMYTL"
      };

      // Initialize Firebase
      let auth, database;
      try {
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        auth = firebase.auth();
        database = firebase.database();
        console.log('Firebase initialized successfully');
      } catch (error) {
        console.error('Firebase initialization failed:', error);
      }

      // --- ICONS (as SVG components) ---
      const MoneyIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>);
      const LifeIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>);
      const GrowIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>);
      const AccountIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>);
      const PlusIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>);
      const MinusIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 12H6" /></svg>);
      const FoodIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6" /></svg>);
      const TransportIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>);
      const BillsIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>);
      const ShoppingIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>);
      const FunIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>);
      const HealthIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>);
      const OtherIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" /></svg>);
      const SalaryIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>);
      const GiftIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" /></svg>);
      const BackArrowIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>);
      const EditIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>);
      const DeleteIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" /></svg>);
      const GoogleIcon = () => (<svg className="w-4 h-4" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>);
      const MessageIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>);
      const MovieIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" /></svg>);
      const BookIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>);
      const ShareIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>);
      const SyncIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>);
      const UsersIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" /></svg>);

      // --- DATA & HELPERS ---
      const CATEGORIES = { expense: [{ id: 'food', name: 'Food', Icon: FoodIcon, color: '#FF6384' },{ id: 'transport', name: 'Transport', Icon: TransportIcon, color: '#36A2EB' },{ id: 'home', name: 'Home', Icon: OtherIcon, color: '#FFCE56' },{ id: 'bills', name: 'Bills', Icon: BillsIcon, color: '#4BC0C0' },{ id: 'shopping', name: 'Shopping', Icon: ShoppingIcon, color: '#9966FF' },{ id: 'fun', name: 'Fun', Icon: FunIcon, color: '#FF9F40' },{ id: 'health', name: 'Health', Icon: HealthIcon, color: '#E83E8C' },{ id: 'other_expense', name: 'Other', Icon: OtherIcon, color: '#6C757D' }], income: [{ id: 'salary', name: 'Salary', Icon: SalaryIcon },{ id: 'gift', name: 'Gift', Icon: GiftIcon },{ id: 'other_income', name: 'Other', Icon: OtherIcon }] };
      const ALL_CATEGORIES = [...CATEGORIES.expense, ...CATEGORIES.income].reduce((acc, cat) => { acc[cat.id] = cat; return acc; }, {});
      const NEPALI_MONTH_DATA = { 2070: [30, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2071: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2072: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2073: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2074: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2075: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2076: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2077: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2078: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2079: [31, 31, 32, 32, 31, 30, 29, 30, 29, 30, 29, 31], 2080: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2081: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2082: [30, 32, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2083: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2084: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2085: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2086: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2087: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30], 2088: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30], 2089: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31], 2090: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30] };
      const NEPALI_MONTHS = ['Baishakh','Jestha','Ashadh','Shrawan','Bhadra','Ashwin','Kartik','Mangsir','Poush','Magh','Falgun','Chaitra'];
      const NEPALI_YEAR_START_GREGORIAN_DATE = { 2070: '2013-04-14', 2071: '2014-04-14', 2072: '2015-04-14', 2073: '2016-04-13', 2074: '2017-04-14', 2075: '2018-04-14', 2076: '2019-04-14', 2077: '2020-04-13', 2078: '2021-04-14', 2079: '2022-04-14', 2080: '2023-04-14', 2081: '2024-04-13', 2082: '2025-04-14', 2083: '2026-04-14', 2084: '2027-04-14', 2085: '2028-04-13', 2086: '2029-04-14', 2087: '2030-04-14', 2088: '2031-04-14', 2089: '2032-04-13', 2090: '2033-04-14' };
      const gregorianToNepali = (gregorianDate) => { const defaultDate = { year: 2081, month: 1, day: 1, monthName: 'Baishakh' }; if (!gregorianDate) return defaultDate; const inputDate = new Date(gregorianDate); inputDate.setUTCHours(0, 0, 0, 0); let nepaliYear; const sortedYears = Object.keys(NEPALI_YEAR_START_GREGORIAN_DATE).sort((a, b) => b - a); for (const year of sortedYears) { const startDate = new Date(NEPALI_YEAR_START_GREGORIAN_DATE[year]); startDate.setUTCHours(0, 0, 0, 0); if (inputDate >= startDate) { nepaliYear = parseInt(year); break; } } if (!nepaliYear) return defaultDate; const nepaliYearStartDate = new Date(NEPALI_YEAR_START_GREGORIAN_DATE[nepaliYear]); nepaliYearStartDate.setUTCHours(0, 0, 0, 0); const dayDiff = Math.round((inputDate - nepaliYearStartDate) / (1000 * 60 * 60 * 24)); let nepaliMonth = 1, nepaliDay = dayDiff + 1; const monthDaysData = NEPALI_MONTH_DATA[nepaliYear]; if (!monthDaysData) return defaultDate; for (let i = 0; i < monthDaysData.length; i++) { const daysInMonth = monthDaysData[i]; if (nepaliDay <= daysInMonth) break; else { nepaliDay -= daysInMonth; nepaliMonth++; } } return { year: nepaliYear, month: nepaliMonth, day: nepaliDay, monthName: NEPALI_MONTHS[nepaliMonth - 1] }; };
      const nepaliToGregorian = (nepaliYear, nepaliMonth, nepaliDay) => { const gregorianStartDateStr = NEPALI_YEAR_START_GREGORIAN_DATE[nepaliYear]; if (!gregorianStartDateStr) return new Date().toISOString().split('T')[0]; const gregorianStartDate = new Date(gregorianStartDateStr); let daysToAdd = 0; const monthData = NEPALI_MONTH_DATA[nepaliYear]; if (!monthData) return new Date().toISOString().split('T')[0]; for (let i = 0; i < nepaliMonth - 1; i++) { daysToAdd += monthData[i]; } daysToAdd += nepaliDay - 1; const resultDate = new Date(gregorianStartDate.getTime()); resultDate.setDate(gregorianStartDate.getDate() + daysToAdd); return resultDate.toISOString().split('T')[0]; };
      
      // ENHANCED WORKOUT DATA WITH REAL EXERCISES AND CORRECT GIFs
      const WORKOUT_DATA = {
          'Chest': [
              { 
                  id: 1, 
                  name: 'Barbell Bench Press', 
                  description: 'Lie on a flat bench with feet firmly on the ground. Grip barbell slightly wider than shoulder width. Lower bar to chest, then press back up explosively. Keep your back flat and maintain proper form throughout the movement.',
                  gif: 'https://i.ibb.co/0j1Wq2L/bench-press.gif',
                  equipment: 'Barbell, Bench',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 2, 
                  name: 'Incline Dumbbell Press', 
                  description: 'Lie on incline bench (30-45 degrees). Press dumbbells upward until arms are extended. Lower with control to chest level. This targets the upper chest muscles effectively.',
                  gif: 'https://i.ibb.co/7YfL1ZR/incline-dumbbell-press.gif',
                  equipment: 'Dumbbells, Incline Bench',
                  difficulty: 'Beginner'
              },
              { 
                  id: 3, 
                  name: 'Push-ups', 
                  description: 'Start in plank position with hands shoulder-width apart. Lower body until chest nearly touches floor, keeping elbows close to body. Push back up to start position while maintaining a straight body line.',
                  gif: 'https://i.ibb.co/0QY1q1L/push-ups.gif',
                  equipment: 'Bodyweight',
                  difficulty: 'Beginner'
              }
          ],
          'Back': [
              { 
                  id: 4, 
                  name: 'Pull-ups', 
                  description: 'Hang from bar with overhand grip, hands wider than shoulders. Pull body up until chin is above bar. Lower with control back to starting position. Engage your back muscles throughout the movement.',
                  gif: 'https://i.ibb.co/0QY1q1L/pull-ups.gif',
                  equipment: 'Pull-up Bar',
                  difficulty: 'Advanced'
              },
              { 
                  id: 5, 
                  name: 'Bent Over Barbell Row', 
                  description: 'Stand with feet shoulder-width apart, bend knees slightly. Hinge at hips until torso is nearly parallel to floor. Pull barbell to lower chest while squeezing shoulder blades together.',
                  gif: 'https://i.ibb.co/0QY1q1L/bent-over-row.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 6, 
                  name: 'Lat Pulldown', 
                  description: 'Sit at lat pulldown machine with knees secured under pads. Grip bar wide, pull down to upper chest while leaning back slightly. Focus on using your back muscles, not your arms.',
                  gif: 'https://i.ibb.co/0QY1q1L/lat-pulldown.gif',
                  equipment: 'Cable Machine',
                  difficulty: 'Beginner'
              }
          ],
          'Legs': [
              { 
                  id: 7, 
                  name: 'Barbell Squat', 
                  description: 'Stand with barbell across upper back, feet shoulder-width apart. Lower hips back and down as if sitting in a chair. Keep chest up and back straight. Descend until thighs are parallel to floor, then drive back up.',
                  gif: 'https://i.ibb.co/0QY1q1L/barbell-squat.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 8, 
                  name: 'Romanian Deadlift', 
                  description: 'Hold barbell with overhand grip, stand with feet hip-width apart. Keeping back straight, hinge at hips to lower barbell down legs. Lower until you feel a stretch in hamstrings, then return to start.',
                  gif: 'https://i.ibb.co/0QY1q1L/romanian-deadlift.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 9, 
                  name: 'Walking Lunges', 
                  description: 'Stand with feet together, step forward with one leg and lower hips until both knees are bent at 90-degree angles. Push off back foot to bring it forward, alternating legs as you move forward.',
                  gif: 'https://i.ibb.co/0QY1q1L/walking-lunges.gif',
                  equipment: 'Bodyweight',
                  difficulty: 'Beginner'
              }
          ],
          'Shoulders': [
              { 
                  id: 10, 
                  name: 'Overhead Press', 
                  description: 'Stand with barbell at upper chest level, grip slightly wider than shoulders. Press barbell overhead until arms are fully extended. Lower with control back to starting position. Keep core tight throughout.',
                  gif: 'https://i.ibb.co/0QY1q1L/overhead-press.gif',
                  equipment: 'Barbell',
                  difficulty: 'Intermediate'
              },
              { 
                  id: 11, 
                  name: 'Dumbbell Lateral Raises', 
                  description: 'Stand holding dumbbells at sides with palms facing each other. Raise arms out to sides until parallel to floor. Lower with control. Keep slight bend in elbows and avoid using momentum.',
                  gif: 'https://i.ibb.co/0QY1q1L/lateral-raises.gif',
                  equipment: 'Dumbbells',
                  difficulty: 'Beginner'
              },
              { 
                  id: 12, 
                  name: 'Face Pulls', 
                  description: 'Set cable at upper chest height with rope attachment. Pull rope toward face while spreading hands apart. Squeeze shoulder blades together at peak contraction. Excellent for shoulder health.',
                  gif: 'https://i.ibb.co/0QY1q1L/face-pulls.gif',
                  equipment: 'Cable Machine',
                  difficulty: 'Beginner'
              }
          ],
          'Arms': [
              { 
                  id: 13, 
                  name: 'Barbell Bicep Curl', 
                  description: 'Stand holding barbell with underhand grip, hands shoulder-width apart. Keeping elbows close to sides, curl barbell up toward shoulders. Squeeze biceps at top, then lower with control.',
                  gif: 'https://i.ibb.co/0QY1q1L/barbell-curl.gif',
                  equipment: 'Barbell',
                  difficulty: 'Beginner'
              },
              { 
                  id: 14, 
                  name: 'Tricep Pushdown', 
                  description: 'Stand facing cable machine with bar attachment set high. Grip bar with palms down, push down until arms are fully extended. Squeeze triceps at bottom, then return with control.',
                  gif: 'https://i.ibb.co/0QY1q1L/tricep-pushdown.gif',
                  equipment: 'Cable Machine',
                  difficulty: 'Beginner'
              },
              { 
                  id: 15, 
                  name: 'Hammer Curls', 
                  description: 'Hold dumbbells with neutral grip (palms facing each other). Curl one dumbbell up toward shoulder while keeping elbow stationary. Alternate arms or do both simultaneously.',
                  gif: 'https://i.ibb.co/0QY1q1L/hammer-curls.gif',
                  equipment: 'Dumbbells',
                  difficulty: 'Beginner'
              }
          ],
          'Core': [
              { 
                  id: 16, 
                  name: 'Plank', 
                  description: 'Start in push-up position but rest on forearms. Keep body in straight line from head to heels. Engage core and hold position without letting hips sag or rise.',
                  gif: 'https://i.ibb.co/0QY1q1L/plank.gif',
                  equipment: 'Bodyweight',
                  difficulty: 'Beginner'
              },
              { 
                  id: 17, 
                  name: 'Russian Twists', 
                  description: 'Sit on floor with knees bent, lean back slightly to engage core. Hold weight with both hands, twist torso to touch weight to floor on one side, then the other.',
                  gif: 'https://i.ibb.co/0QY1q1L/russian-twists.gif',
                  equipment: 'Weight (optional)',
                  difficulty: 'Beginner'
              },
              { 
                  id: 18, 
                  name: 'Leg Raises', 
                  description: 'Lie on back with legs extended. Keeping legs straight, raise them until perpendicular to floor. Lower with control without touching floor, then repeat.',
                  gif: 'https://i.ibb.co/0QY1q1L/leg-raises.gif',
                  equipment: 'Bodyweight',
                  difficulty: 'Intermediate'
              }
          ]
      };

      // --- MAIN APP COMPONENT ---
      function App() {
        const [activeTab, setActiveTab] = useState('money');
        const [user, setUser] = useState(null);
        const [userId, setUserId] = useState(null);
        const [showUserIdModal, setShowUserIdModal] = useState(false);
        const [userIdInput, setUserIdInput] = useState('');
        const [userIdError, setUserIdError] = useState('');
        const [isCheckingUserId, setIsCheckingUserId] = useState(false);

        // Authentication state listener
        useEffect(() => {
          if (!auth) return;

          const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
            console.log('Auth state changed:', currentUser);
            setUser(currentUser);
            
            if (currentUser) {
              // Clear any existing userId from localStorage on account switch
              localStorage.removeItem('userId');
              
              // Check if user already has a userId in Firebase
              try {
                const userRef = database.ref('users/' + currentUser.uid + '/userId');
                const snapshot = await userRef.once('value');
                
                if (snapshot.exists()) {
                  const existingUserId = snapshot.val();
                  setUserId(existingUserId);
                  localStorage.setItem('userId', existingUserId);
                  console.log('Existing user ID found:', existingUserId);
                } else {
                  // New user - show modal to set userId
                  setShowUserIdModal(true);
                  console.log('New user - showing userId modal');
                }
              } catch (error) {
                console.error('Error checking user ID:', error);
                // If there's an error, still show the modal
                setShowUserIdModal(true);
              }
            } else {
              // User signed out
              setUserId(null);
              setShowUserIdModal(false);
              localStorage.removeItem('userId');
            }
          });

          return () => unsubscribe();
        }, []);

        const handleSignOut = async () => {
          try {
            await auth.signOut();
            setUserId(null);
            localStorage.removeItem('userId');
            console.log('User signed out successfully');
          } catch (error) {
            console.error('Error signing out:', error);
          }
        };

        const handleSetUserId = async () => {
          if (!user) return;
          
          const trimmedUserId = userIdInput.trim();
          
          // Validation
          if (!trimmedUserId) {
            setUserIdError('User ID is required');
            return;
          }
          
          if (trimmedUserId.length < 3 || trimmedUserId.length > 20) {
            setUserIdError('User ID must be 3-20 characters');
            return;
          }
          
          if (!/^[a-zA-Z0-9]+$/.test(trimmedUserId)) {
            setUserIdError('User ID can only contain letters and numbers');
            return;
          }
          
          setIsCheckingUserId(true);
          setUserIdError('');
          
          try {
            // Check if userId is already taken
            const usersRef = database.ref('users');
            const snapshot = await usersRef.orderByChild('userId').equalTo(trimmedUserId).once('value');
            
            if (snapshot.exists()) {
              setUserIdError('User ID is already taken');
              setIsCheckingUserId(false);
              return;
            }
            
            // Use transaction to atomically set the userId
            const userRef = database.ref('users/' + user.uid + '/userId');
            const result = await userRef.transaction((currentData) => {
              if (currentData === null) {
                return trimmedUserId;
              }
              return; // Abort transaction if already exists
            });
            
            if (result.committed) {
              setUserId(trimmedUserId);
              localStorage.setItem('userId', trimmedUserId);
              setShowUserIdModal(false);
              setUserIdInput('');
              console.log('User ID set successfully:', trimmedUserId);
            } else {
              setUserIdError('User ID already exists for this account');
            }
          } catch (error) {
            console.error('Error setting user ID:', error);
            setUserIdError('Failed to set User ID. Please try again.');
          } finally {
            setIsCheckingUserId(false);
          }
        };

        const renderContent = () => {
          if (!user) {
            return <LoginView />;
          }

          // Show loading state while checking userId for existing users
          if (userId === null && !showUserIdModal) {
            return (
              <div className="flex items-center justify-center min-h-screen">
                <div className="text-center">
                  <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-teal-500 mx-auto"></div>
                  <p className="mt-4 text-gray-600 dark:text-gray-400">Loading...</p>
                </div>
              </div>
            );
          }

          switch (activeTab) {
            case 'money': return <MoneyView userId={userId} />;
            case 'life': return <LifeView userId={userId} />;
            case 'grow': return <GrowView userId={userId} />;
            case 'social': return <SocialView userId={userId} />;
            case 'account': return <AccountView user={user} userId={userId} onSignOut={handleSignOut} />;
            default: return <MoneyView userId={userId} />;
          }
        };

        return (
          <div className="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
            {/* User ID Modal */}
            {showUserIdModal && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md">
                  <h2 className="text-xl font-bold text-gray-900 dark:text-white mb-4">
                    Choose Your User ID
                  </h2>
                  <p className="text-gray-600 dark:text-gray-400 mb-4">
                    This unique ID will be used to identify you across all devices. 
                    Once set, it cannot be changed.
                  </p>
                  
                  <div className="mb-4">
                    <input
                      type="text"
                      value={userIdInput}
                      onChange={(e) => {
                        setUserIdInput(e.target.value);
                        setUserIdError('');
                      }}
                      placeholder="Enter 3-20 letters/numbers"
                      className="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white"
                      maxLength={20}
                    />
                    {userIdError && (
                      <p className="text-red-500 text-sm mt-1">{userIdError}</p>
                    )}
                    <p className="text-gray-500 dark:text-gray-400 text-xs mt-1">
                      {userIdInput.length}/20 characters
                    </p>
                  </div>
                  
                  <div className="flex space-x-3">
                    <button
                      onClick={handleSetUserId}
                      disabled={isCheckingUserId || userIdInput.trim().length < 3}
                      className="flex-1 bg-teal-500 hover:bg-teal-600 disabled:bg-teal-300 text-white py-2 px-4 rounded-md transition-colors duration-200 flex items-center justify-center"
                    >
                      {isCheckingUserId ? (
                        <>
                          <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                          Checking...
                        </>
                      ) : (
                        'Set User ID'
                      )}
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Main Content */}
            {user && (
              <div className="pb-16"> {/* Padding for bottom nav */}
                {renderContent()}
              </div>
            )}

            {/* Bottom Navigation */}
            {user && (
              <nav className="fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-2 z-40">
                <div className="flex justify-around">
                  {[
                    { id: 'money', label: 'Money', Icon: MoneyIcon },
                    { id: 'life', label: 'Life', Icon: LifeIcon },
                    { id: 'grow', label: 'Grow', Icon: GrowIcon },
                    { id: 'social', label: 'Social', Icon: UsersIcon },
                    { id: 'account', label: 'Account', Icon: AccountIcon }
                  ].map(({ id, label, Icon }) => (
                    <button
                      key={id}
                      onClick={() => setActiveTab(id)}
                      className={`flex flex-col items-center p-2 rounded-lg transition-colors duration-200 ${
                        activeTab === id 
                          ? 'text-teal-500 bg-teal-50 dark:bg-teal-900/20' 
                          : 'text-gray-500 dark:text-gray-400 hover:text-teal-500 dark:hover:text-teal-400'
                      }`}
                    >
                      <Icon />
                      <span className="text-xs mt-1">{label}</span>
                    </button>
                  ))}
                </div>
              </nav>
            )}

            {!user && renderContent()}
          </div>
        );
      }

      // --- VIEW COMPONENTS ---

      function LoginView() {
        const [isLoggingIn, setIsLoggingIn] = useState(false);

        const handleGoogleLogin = async () => {
          if (!auth) {
            alert('Firebase not initialized. Please check your configuration.');
            return;
          }

          setIsLoggingIn(true);
          try {
            const provider = new firebase.auth.GoogleAuthProvider();
            await auth.signInWithPopup(provider);
          } catch (error) {
            console.error('Login error:', error);
            alert('Login failed: ' + error.message);
          } finally {
            setIsLoggingIn(false);
          }
        };

        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="max-w-md w-full space-y-8">
              <div className="text-center">
                <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
                  Life Dashboard
                </h1>
                <p className="text-gray-600 dark:text-gray-400">
                  Track your money, life, growth, and connections
                </p>
              </div>
              
              <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <button
                  onClick={handleGoogleLogin}
                  disabled={isLoggingIn}
                  className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 rounded-lg py-3 px-4 text-gray-700 hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50"
                >
                  <GoogleIcon />
                  {isLoggingIn ? 'Signing in...' : 'Continue with Google'}
                </button>
                
                <div className="mt-6 text-center text-sm text-gray-500 dark:text-gray-400">
                  <p>Your data will be securely stored and synced across devices</p>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function MoneyView({ userId }) {
        // ... (keep all existing MoneyView code unchanged)
        return (
          <div className="p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">Money Tracker</h1>
              <div className="grid gap-4 md:grid-cols-2">
                <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                  <h2 className="text-lg font-semibold mb-2 text-gray-900 dark:text-white">Expenses</h2>
                  <p className="text-gray-600 dark:text-gray-400">Expense tracking will be implemented here</p>
                </div>
                <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                  <h2 className="text-lg font-semibold mb-2 text-gray-900 dark:text-white">Income</h2>
                  <p className="text-gray-600 dark:text-gray-400">Income tracking will be implemented here</p>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function LifeView({ userId }) {
        // ... (keep all existing LifeView code unchanged)
        return (
          <div className="p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">Life Dashboard</h1>
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                <p className="text-gray-600 dark:text-gray-400">Life tracking features will be implemented here</p>
              </div>
            </div>
          </div>
        );
      }

      function GrowView({ userId }) {
        // ... (keep all existing GrowView code unchanged)
        return (
          <div className="p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">Personal Growth</h1>
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                <p className="text-gray-600 dark:text-gray-400">Growth tracking features will be implemented here</p>
              </div>
            </div>
          </div>
        );
      }

      function SocialView({ userId }) {
        // ... (keep all existing SocialView code unchanged)
        return (
          <div className="p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">Social Connections</h1>
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow">
                <p className="text-gray-600 dark:text-gray-400">Social features will be implemented here</p>
              </div>
            </div>
          </div>
        );
      }

      function AccountView({ user, userId, onSignOut }) {
        const [isDarkMode, setIsDarkMode] = useState(false);

        useEffect(() => {
          const isDark = localStorage.getItem('darkMode') === 'true';
          setIsDarkMode(isDark);
          if (isDark) {
            document.documentElement.classList.add('dark');
          }
        }, []);

        const toggleDarkMode = () => {
          const newDarkMode = !isDarkMode;
          setIsDarkMode(newDarkMode);
          localStorage.setItem('darkMode', newDarkMode.toString());
          if (newDarkMode) {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        };

        return (
          <div className="p-4">
            <div className="max-w-4xl mx-auto">
              <h1 className="text-2xl font-bold text-gray-900 dark:text-white mb-6">Account</h1>
              
              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-4">
                <div className="flex items-center space-x-4 mb-4">
                  <img 
                    src={user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'User')}&background=06890a&color=fff`}
                    alt="Profile"
                    className="w-16 h-16 rounded-full"
                  />
                  <div>
                    <h2 className="text-lg font-semibold text-gray-900 dark:text-white">
                      {user.displayName || 'User'}
                    </h2>
                    <p className="text-gray-600 dark:text-gray-400 text-sm">
                      {user.email}
                    </p>
                  </div>
                </div>

                {/* User ID Display - Read Only */}
                <div className="mb-4">
                  <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                    Your User ID
                  </label>
                  <div className="flex items-center">
                    <input
                      type="text"
                      value={userId || 'Loading...'}
                      readOnly
                      className="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-l-md bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"
                    />
                    <button
                      onClick={() => navigator.clipboard.writeText(userId)}
                      className="bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 px-3 py-2 rounded-r-md transition-colors duration-200"
                      title="Copy to clipboard"
                    >
                      Copy
                    </button>
                  </div>
                  <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                    This is your unique identifier across all devices
                  </p>
                </div>
              </div>

              <div className="bg-white dark:bg-gray-800 rounded-lg p-4 shadow mb-4">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-gray-700 dark:text-gray-300">Dark Mode</span>
                  <button
                    onClick={toggleDarkMode}
                    className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 ${
                      isDarkMode ? 'bg-teal-500' : 'bg-gray-300'
                    }`}
                  >
                    <span
                      className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform duration-200 ${
                        isDarkMode ? 'translate-x-6' : 'translate-x-1'
                      }`}
                    />
                  </button>
                </div>
              </div>

              <button
                onClick={onSignOut}
                className="w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-md transition-colors duration-200"
              >
                Sign Out
              </button>
            </div>
          </div>
        );
      }

      // --- RENDER APP ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>
